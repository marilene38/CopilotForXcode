name: Auto-close PR

on:
  pull_request_target:
    types: [opened]

permissions:
  pull-requests: write
  issues: write

concurrency:
  group: auto-close-pr-${{ github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  close:
    name: Close fork PRs with guidance
    runs-on: ubuntu-latest
    steps:
      - name: Close PR from fork with message
        if: ${{ github.event.pull_request.head.repo.full_name != github.repository }}
        env:
          GH_REPO: ${{ github.repository }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          set -euo pipefail
          gh pr close "$PR_NUMBER" \
            --reason not_planned \
            --comment "$(cat <<'EOF'
          Thanks for the pull request! At the moment we are not accepting contributions to this repository.

          Feedback for GitHub Copilot for Xcode can be shared in the Copilot community discussions:
          https://github.com/orgs/community/discussions/categories/copilot
          EOF
          )"
